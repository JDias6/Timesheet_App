{% extends "base.html" %}

{% block title %}My Leave Requests{% endblock %}

{% block content %}
<div class="p-6">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold">My Leave Requests</h1>
    <div class="flex space-x-2">
      <a href="{% url 'timesheet:leave_request' %}" 
         class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        + New Request
      </a>
    </div>
  </div>

  <!-- Filters with HTMX -->
  <div class="bg-white shadow rounded-lg p-4 mb-6">
    <form 
      hx-get="{% url 'timesheet:my_requests' %}"
      hx-target="#requests-table"
      hx-trigger="submit"
      class="flex items-center space-x-4"
    >
      <label class="text-sm font-medium text-gray-700">Filter by status:</label>
      {{ filter_form.status }}
      
      <label class="text-sm font-medium text-gray-700">Leave type:</label>
      {{ filter_form.leave_type }}
      
      <button type="submit" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
        Filter
      </button>
      
      <a href="{% url 'timesheet:my_requests' %}" 
         class="px-3 py-1 border rounded text-sm hover:bg-gray-50"
         hx-get="{% url 'timesheet:my_requests' %}"
         hx-target="#requests-table">
        Clear
      </a>
    </form>
  </div>

  <!-- Requests Table -->
  <div id="requests-table">
    {% include 'partials/leave_requests_table.html' %}
  </div>
</div>

<!-- HTMX Modal for rejection reason -->
<div id="rejection-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
  <div class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-lg p-6 max-w-md w-full">
      <h3 class="text-lg font-semibold mb-3">Rejection Reason</h3>
      <p id="rejection-text" class="text-gray-700 mb-4"></p>
      <button 
        onclick="document.getElementById('rejection-modal').classList.add('hidden')"
        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        Close
      </button>
    </div>
  </div>
</div>

<script>
function showRejectionReason(reason) {
  document.getElementById('rejection-text').textContent = reason;
  document.getElementById('rejection-modal').classList.remove('hidden');
}
</script>
{% endblock %}